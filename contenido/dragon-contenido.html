<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contenido</title>
    <link rel="stylesheet" href="contenido.css">
    <link rel="website icon" type="png" href="../img/logo-blanco-vacio.png">
</head>
<body>
    <!-- Encabezado de la página -->
    <header>
        <!-- Logo de la página, enlaza a la página principal -->
        <a href="../main.html" class="logo">
            <img src="../img/logo oscuro.png" alt="Logo Crescento">
        </a>
        <!-- Barra de búsqueda -->
        <div class="search-bar">
            <img src="../img/lupa.png" alt="Icono de búsqueda"> <!-- Icono de búsqueda alineado a la izquierda -->
            <input type="text" placeholder="Buscar proyectos, categorías..." aria-label="Buscar proyectos">
        </div>
        <!-- Icono de perfil, enlaza a la página de perfil -->
        <a href="../perfil/perfil.html" class="profile-icon">
            <img src="../img/perfil.png" alt="Icono de perfil">
        </a>
    </header>

    <!-- Contenedor de contenido principal -->
    <main>
        <!-- Primer contenedor: Proyecto destacado -->
        <section class="project-container">
            <div class="project-image">
                <img src="../img/dragon.jpeg" alt="Imagen del proyecto">
            </div>

            <div class="project-info">
                <h2 class="project-title">Here Be Dragons</h2>
                <p class="project-description">Here Be Dragons es un auténtico libro de consulta para folcloristas, así como una guía entretenida para los aspirantes a cazadores de dragones.</p>
                <p class="project-donations">Inversion total: $0 COP</p>
                <button class="invest-button">Invertir en este proyecto</button>
            </div>
        </section>


        <!-- Contenedor alternativo (color #bc8741) -->
        <section class="custom-container bc8741">
            <h2 class="custom-title">Sobre el libro</h2>
            <div class="centered-image">
                <img src="../img/dragon1.jpg" alt="Producto del proyecto">
            </div>
            <p class="custom-text">In the 1970s, Ralph Whitlock walked the countryside of England, Scotland, and Wales to record places where dragons have left their mark . . . and the evidence of dragons was everywhere!</p>

            <p class="custom-text">Dragons are woven into the folk history of villages and hamlets—they snarl from church adornments and they survive in mumming plays and other pageants. Tracing their remains, in whatever form they are to be found, is not only a fascinating pastime but a glimpse into how our rural forbearers thought and behaved, for dragons played the vital role of representing evil and destruction in the pantheon of the country dweller.</p>

            <p class="custom-text">Eye of Newt Books and Welsh artist, Rowynn Ellis, are working to update and republish this historic sourcebook. In this new edition of Here Be Dragons, readers will get to experience the book’s original engravings, photographs, and line drawings, as well as twenty-eight brand new, beautiful illustrations of dragons. The hardcover 200+ page book will feature the various histories of dragons, their different types, and the authentic folklore that surrounds them.</p>
        </section>

        <!-- Contenedor alternativo (color #f6f4f3) -->
        <section class="custom-container f6f4f3">
            <div class="flex-container">
                <div class="left-image">
                    <img src="../img/dragon2.jpeg" alt="Otra imagen">
                </div>

                <div class="right-text">
                    <h2 class="custom-title2">Una nota de la artista</h2>
                    <p>Me llamo Rowynn Ellis y soy artista profesional de folclore y fantasía desde hace unos nueve años. Crecí en North Cymru (Gales), rodeada de mitología y leyendas, y mi obra ha estado muy influenciada e inspirada por el folclore, la fantasía y la mitología. Utilizo principalmente bolígrafo, acuarela y medios digitales como mis medios de elección.</p>

                    <p>Desde pequeña me han atraído las criaturas míticas, en concreto los dragones. Siempre me han encantado y las historias que había oído sobre ellos. Un día, hace unos años, estaba rebuscando en una caja de libros viejos de la biblioteca de la universidad local, cuando me topé con una copia de Here Be Dragons, una maravillosa guía de las leyendas de dragones de Gran Bretaña y sus islas circundantes. Nunca había visto nada parecido. Supe en ese momento que tenía que añadir este libro a mi colección. En cuanto llegué a casa con el libro, me senté y me dediqué a leerlo durante lo que parecieron horas. Me cautivó su encanto mágico. Sentí que había dado con algo bastante especial. He reunido una gran colección de libros sobre dragones y este era, sin duda, uno de mis favoritos.</p>
                </div>
            </div>
        </section>

        
    </main>

    <!-- Modal para invertir -->
    <div id="invest-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Invertir en este proyecto</h2>
            <form id="investment-form">
                <label for="name">Nombre completo:</label>
                <input type="text" id="name" required placeholder="Nombre - Apellido">

                <label for="card-number">Número de tarjeta:</label>
                <input type="text" id="card-number" required maxlength="16" placeholder="1234 5678 9012 3456">

                <label for="expiration">Fecha de expiración (MM/AA):</label>
                <input type="text" id="expiration" required maxlength="5" placeholder="MM/AA">

                <label for="cvv">Código CVV:</label>
                <input type="password" id="cvv" required maxlength="3" placeholder="123">

                <label for="amount">Cantidad a invertir (COP):</label>
                <input type="number" id="amount" required min="1000" step="1000" placeholder="Min. 1000 COP">

                <button type="submit" class="submit-button">Confirmar inversión</button>
            </form>
        </div>
    </div>

    <script type="module">
        // Import Firebase desde CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDAbSzqzrVS57vELGI-G6ucRbyp3kpglcg",
            authDomain: "crescentobd-df080.firebaseapp.com",
            databaseURL: "https://crescentobd-df080-default-rtdb.firebaseio.com",
            projectId: "crescentobd-df080",
            storageBucket: "crescentobd-df080.appspot.com",
            messagingSenderId: "632561275915",
            appId: "1:632561275915:web:0940af834cbf31a819a30e",
            measurementId: "G-46K91H4PVE"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Referencias HTML y lógica de inversión
        const investButton = document.querySelector(".invest-button");
        const modal = document.getElementById("invest-modal");
        const closeButton = document.querySelector(".close-button");
        const investmentForm = document.getElementById("investment-form");
        const donationsElement = document.querySelector(".project-donations");

        const projectKey = "dragon";
        const projectRef = ref(db, `projects/${projectKey}`);

        // Actualiza las donaciones mostradas
        onValue(projectRef, (snapshot) => {
            const data = snapshot.val();
            const totalDonations = data ? data.totalDonations : 0;
            donationsElement.textContent = `Inversion total: $${totalDonations} COP`;
        });

        // Abrir modal
        investButton.addEventListener("click", () => {
            modal.style.display = "flex";
        });

        // Cerrar modal
        closeButton.addEventListener("click", () => {
            modal.style.display = "none";
        });

        // Manejo del formulario
        investmentForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const amount = parseInt(document.getElementById("amount").value, 10);

            if (isNaN(amount) || amount < 1000) {
                alert("Por favor, ingresa una cantidad válida (mínimo 1000 COP).");
                return;
            }

            get(projectRef).then((snapshot) => {
                const data = snapshot.val();
                const currentTotal = data ? data.totalDonations : 0;

                update(projectRef, { totalDonations: currentTotal + amount })
                    .then(() => {
                        alert("¡Gracias por tu inversión!");
                        modal.style.display = "none";
                        investmentForm.reset();
                    })
                    .catch((error) => console.error("Error al actualizar donaciones:", error));
            }).catch((error) => console.error("Error al obtener donaciones:", error));
        });

        // Cerrar modal al hacer clic afuera
        window.addEventListener("click", (event) => {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        });
    </script>
</body>
</html>